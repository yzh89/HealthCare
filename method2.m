tic
%number of years
Ny=10;

%number of controller
Nu=10;
%number of measurement
Nmu=3;

p=zeros(Nu,Nmu,3,3);

% p(1,1} = [0.4,0.3,0.3; 0.3, 0.5; 0.2; 0.3, 0.2, 0.5]
p(1,1,:,:)=[	0.5,	0.5,	0;	0.3,	0.6,	0.1;	0,	0.65,	0.35;	];
p(2,1,:,:)=[	0.25,	0.5,	0.25;	0.3,	0.55,	0.15;	0.35,	0.55,	0.1;	];
p(3,1,:,:)=[	0.125,	0.5,	0.375;	0.6,	0.1,	0.3;	0.23,	0.6,	0.17;	];
p(6,1,:,:)=[	0.125,	0.5,	0.375;	0.3,	0.6,	0.1;	0.187,	0.55,	0.263;	];
p(	1,2,:,:)=[	0.1,	0.6,	0.3;	0.2,	0.5,	0.3;	0.15,	0.65,	0.2;	];
p(	4,2,:,:)=[	0.05,	0.8,	0.15;	0.2,	0.5,	0.3;	0.15,	0.65,	0.2;	];
p(	5,2,:,:)=[	0.05,	0.8,	0.15;	0.25,	0.55,	0.2;	0.3,	0.58,	0.12;	];
p(	7,2,:,:)=[	0.3,	0.5,	0.2;	0.3,	0.6,	0.1;	0.25,	0.65,	0.1;	];
p(	9,2,:,:)=[	0.3,	0.45,	0.25;	0.175,	0.65,	0.175;	0.225,	0.675,	0.1;	];
p(	1,3,:,:)=[	0.25,	0.55,	0.2;	0.2,	0.7,	0.1;	0.25,	0.55,	0.2;	];
p(	8,3,:,:)=[	0.2,	0.6,	0.2;	0.3,	0.6,	0.1;	0.2,	0.67,	0.13;	];
p(	10,3,:,:)=[	0.25,	0.5,	0.25;	0.3,	0.6,	0.1;	0.27,	0.65,	0.08;	];

p(4,1,:,:)=eye(3);
p(5,1,:,:)=eye(3);

p(7,1,:,:)= eye(3);
p(8,1,:,:)= eye(3);
p(9,1,:,:)=eye(3);
p(10,1,:,:)=eye(3);

p(2,2,:,:)=eye(3);

p(3,2,:,:)=eye(3);
p(6,2,:,:) = eye(3);

p(8,2,:,:)=eye(3);

p(10,2,:,:)=eye(3);


p(2,3,:,:)=eye(3);
p(3,3,:,:)=eye(3);
p(4,3,:,:)=eye(3);
p(5,3,:,:)=eye(3);
p(6,3,:,:)=eye(3);
p(7,3,:,:)= eye(3);
p(9,3,:,:)=eye(3);


%%%Cost
C1=[200, 100, 100, 200, 250, 100, 200, 300, 200, 500];
C2=[120, 200, 60,  120,  180, 50, 100, 100 ,150 ,120];
Cu=C1+C2;
Cmu=[89,97,126];
C.Cu=Cu;
C.Cmu=Cmu;

W1=[0.81251, 0.06284, 0.12465];
%W2=[0.53248, 0.34641, 0.12111];
%W3=[0.42448,0.32491, 0.25061];
W=W1;

lambda=0.1
J=zeros(Ny+1,3);
Q=zeros(Ny,3,Nu,Nmu);
J(Ny+1,:)=lambda*1./W*Ny;
%%
for i=Ny:-1:1
    for x=1:3
        for j=1:Nu
            for k=1:Nmu
                Q(i,x,j,k)=lambda/W(x)*Ny+(1-lambda)*(Cu(j)+Cmu(k))+ J(i+1,:)*squeeze(p(j,k,x,:));
            end
        end
        [qTemp, uTemp]=min(squeeze(Q(i,x,:,:)));
        [JTemp, muTemp]=min(qTemp);
        u(i,x)=uTemp(muTemp);
        mu(i,x)=muTemp;
        J(i,x)=JTemp;
    end
end
t=toc